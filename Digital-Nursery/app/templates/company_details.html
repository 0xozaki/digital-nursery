{% extends 'base.html' %}
{% block title %}{{ company.name }} - Details{% endblock %}
{% block content %}
<style>
.company-details-container {
    background: #f8f9fa;
    min-height: 100vh;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    padding-bottom: 80px; /* ŸÖÿ≥ÿßÿ≠ÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÅŸä ÿßŸÑÿ£ÿ≥ŸÅŸÑ ŸÑÿ™ÿ¨ŸÜÿ® ÿ™ÿØÿßÿÆŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ŸÖÿπ ÿßŸÑÿ≥ŸÑÿ© */
}

/* Header with Back Button - GREEN */
.company-header {
    background: linear-gradient(135deg, #034b06 0%, #06700b 100%);
    color: white;
    padding: 20px;
    position: sticky;
    border-radius: 11px;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 15px rgba(3, 75, 6, 0.2);
    display: flex;
    align-items: center;
}

.back-button {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    margin-right: 15px;
    cursor: pointer;
    padding: 5px;
    transition: transform 0.3s ease;
}

.back-button:hover {
    transform: scale(1.1);
}

.company-banner {
    width: 100%;
    height: 200px;
    object-fit: cover;
    background: linear-gradient(45deg, #034b06, #06700b);
}

/* Company Info Section */
.company-info-section {
    background: white;
    padding: 20px 15px;
    position: relative;
    overflow: hidden;
}

.company-info-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #034b06, #06700b, #034b06);
}

.company-name-main {
    font-size: 24px;
    font-weight: 700;
    color: #034b06;
    margin-bottom: 5px;
}

.company-category {
    color: #666;
    font-size: 16px;
    margin-bottom: 10px;
}

.company-rating-section {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 15px;
}

.rating-stars {
    color: #ff6b00;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 2px;
}

.rating-count {
    color: #666;
    font-size: 14px;
}

/* Divider Lines */
.divider {
    height: 1px;
    background: linear-gradient(90deg, transparent, #034b06, transparent);
    margin: 15px 0;
}

/* Delivery Info Section */
.delivery-info {
    padding: 15px 0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.delivery-label {
    color: #666;
    font-size: 14px;
}

.delivery-by {
    color: #034b06;
    font-weight: 600;
    font-size: 16px;
    background: #e8f5e9;
    padding: 4px 8px;
    border-radius: 6px;
}

/* Promotion Section - GREEN GRADIENT */
.promotion-section {
    background: linear-gradient(135deg, #034b06 0%, #06700b 100%);
    color: white;
    padding: 15px;
    border-radius: 12px;
    margin: 15px 0;
    position: relative;
    overflow: hidden;
}

.promotion-section::before {
    content: '‚ú®';
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 20px;
    opacity: 0.8;
}

.promotion-title {
    font-weight: 600;
    margin-bottom: 5px;
    font-size: 16px;
}

.promotion-subtitle {
    font-size: 14px;
    opacity: 0.9;
}

.try-free-btn {
    background: white;
    color: #034b06;
    border: none;
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: 600;
    margin-top: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(3, 75, 6, 0.3);
}

.try-free-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(3, 75, 6, 0.4);
}

/* Categories Tabs - GREEN */
.categories-tabs {
    background: white;
    padding: 15px;
    border-bottom: 1px solid #e0e0e0;
    overflow-x: auto;
    white-space: nowrap;
}

.categories-tabs::-webkit-scrollbar {
    display: none;
}

.category-tab {
    display: inline-block;
    padding: 8px 16px;
    margin-right: 10px;
    background: #f8f9fa;
    border-radius: 20px;
    color: #666;
    font-weight: 500;
    cursor: pointer;
    border: 1px solid #e0e0e0;
    transition: all 0.3s ease;
}

.category-tab:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(3, 75, 6, 0.1);
}

.category-tab.active {
    background: #034b06;
    color: white;
    border-color: #034b06;
    box-shadow: 0 2px 8px rgba(3, 75, 6, 0.3);
}

.category-tab.featured {
    background: linear-gradient(135deg, #fff8e1, #ffecb3);
    border-color: #ffd54f;
    color: #e65100;
    position: relative;
}

.category-tab.featured::after {
    content: 'üåü';
    margin-left: 5px;
}

/* Section Headers */
.section-header {
    background: white;
    padding: 15px;
    border-bottom: 1px solid #e0e0e0;
    position: relative;
}

.section-header::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 15px;
    right: 15px;
    height: 2px;
    background: linear-gradient(90deg, #034b06, transparent);
}

.section-title {
    font-size: 18px;
    font-weight: 700;
    color: #034b06;
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.section-subtitle {
    color: #666;
    font-size: 14px;
}

/* Products Grid - GREEN THEME */
.products-grid {
    background: white;
    padding: 15px;
}

.product-card {
    display: flex;
    align-items: flex-start;
    padding: 15px 0;
    border-bottom: 1px solid #f0f0f0;
    gap: 15px;
    transition: all 0.3s ease;
    border-radius: 12px;
    margin: 5px 0;
    padding: 15px;
}

.product-card:hover {
    background: #f8fff6;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(3, 75, 6, 0.1);
}

.product-card:last-child {
    border-bottom: none;
}

.product-image {
    width: 80px;
    height: 80px;
    border-radius: 12px;
    object-fit: cover;
    background: #f8f9fa;
    border: 2px solid #e8f5e9;
    flex-shrink: 0;
    transition: all 0.3s ease;
}

.product-card:hover .product-image {
    border-color: #034b06;
    transform: scale(1.05);
}

.product-info {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.product-name {
    font-size: 16px;
    font-weight: 700;
    color: #034b06;
    margin-bottom: 5px;
    line-height: 1.3;
}

.product-description {
    color: #666;
    font-size: 14px;
    line-height: 1.4;
    margin-bottom: 8px;
    flex: 1;
}

.product-price-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
}

.product-price {
    font-size: 18px;
    font-weight: 700;
    color: #034b06;
    background: #e8f5e9;
    padding: 4px 8px;
    border-radius: 6px;
}

.add-button {
    background: #034b06;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    flex-shrink: 0;
    transition: all 0.3s ease;
    box-shadow: 0 2px 6px rgba(3, 75, 6, 0.3);
}

.add-button:hover {
    background: #06700b;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(3, 75, 6, 0.4);
}

.add-button.added {
    background: #4caf50;
    transform: scale(0.95);
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #666;
    background: white;
    border-radius: 12px;
    margin: 10px;
}

.empty-state-icon {
    font-size: 48px;
    margin-bottom: 15px;
    opacity: 0.5;
}

/* Floating Cart - GREEN - IMPROVED POSITIONING */
.floating-cart {
    position: fixed;
    bottom: 70px; /* ŸÅŸàŸÇ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿßŸÑÿ£ÿ≥ŸÅŸÑ ŸÖÿ®ÿßÿ¥ÿ±ÿ© */
    left: 0;
    right: 0;
    background: white;
    padding: 15px;
    box-shadow: 0 -4px 20px rgba(3, 75, 6, 0.15);
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 1001; /* ŸÇŸäŸÖÿ© ÿ£ÿπŸÑŸâ ŸÖŸÜ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÜŸÇŸÑ */
    border-top: 3px solid #034b06;
    margin: 0 10px;
    border-radius: 12px;
    max-width: calc(100% - 20px);
    margin-left: auto;
    margin-right: auto;
}

.cart-label {
    font-size: 16px;
    font-weight: 600;
    color: #034b06;
}

.cart-total {
    font-size: 18px;
    font-weight: 700;
    color: #034b06;
}

.view-cart-btn {
    background: #034b06;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(3, 75, 6, 0.3);
}

.view-cart-btn:hover:not(:disabled) {
    background: #06700b;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(3, 75, 6, 0.4);
}

.view-cart-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* Badges */
.badge {
    background: linear-gradient(135deg, #ff6b00, #ff8f00);
    color: white;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 600;
    margin-left: 5px;
}

/* Promo Codes - GREEN */
.promo-codes {
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    padding: 15px;
    margin: 10px 0;
    border-radius: 12px;
    border: 1px dashed #034b06;
}

.promo-title {
    font-weight: 600;
    color: #034b06;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.promo-code {
    background: white;
    padding: 8px 12px;
    border-radius: 6px;
    margin: 5px 0;
    border: 1px dashed #4caf50;
    font-family: monospace;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.promo-discount {
    color: #034b06;
    font-weight: 600;
}

/* Contact Section - GREEN */
.contact-section {
    background: white;
    padding: 20px 15px;
    margin: 15px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(3, 75, 6, 0.1);
    border: 1px solid #e8f5e9;
}

.contact-title {
    font-size: 18px;
    font-weight: 700;
    color: #034b06;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.contact-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.contact-btn {
    padding: 10px 15px;
    border: 2px solid #034b06;
    border-radius: 8px;
    background: white;
    color: #034b06;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    flex: 1;
    min-width: 120px;
}

.contact-btn:hover {
    background: #034b06;
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(3, 75, 6, 0.3);
}

/* Loading Animation */
@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

.loading {
    animation: pulse 1.5s ease-in-out infinite;
}

/* Success Animation */
@keyframes success {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.success {
    animation: success 0.6s ease-in-out;
}

/* Notification */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #4caf50;
    color: white;
    padding: 15px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 10000;
    display: none;
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
</style>

<!-- Notification Element -->
<div id="notification" class="notification"></div>

<div class="company-details-container">
    <!-- Header with Back Button -->
    <div class="company-header">
        <button class="back-button" onclick="goBack()">‚Üê</button>
        <div style="font-weight: 700; font-size: 18px;">{{ company.name }}</div>
    </div>

    <!-- Company Banner -->
    <img 
        src="{{ company.banner }}" 
        alt="Banner" 
        class="company-banner"
    >

    <!-- Company Info -->
    <div class="company-info-section">
        <div class="company-name-main">{{ company.name }}</div>
        <div class="company-category">{{ company.details }}</div>
        
        <div class="company-rating-section">
            <span class="rating-stars">‚≠ê ‚≠ê ‚≠ê ‚≠ê ‚≠ê</span>
            <span class="rating-count">4.5 (50+ reviews)</span>
        </div>

        <div class="divider"></div>

        <div class="delivery-info">
            <div class="delivery-label">Delivered by</div>
            <div class="delivery-by">ÿ¨ŸäŸÜÿßŸÉŸÖ üçÉ</div>
        </div>

        <!-- Promotion Codes -->
        {% if company.Promo_codes %}
        <div class="promo-codes">
            <div class="promo-title">üéÅ Promo Codes Available</div>
            {% for promo in company.Promo_codes %}
            <div class="promo-code">
                <strong>{{ promo.code }}</strong>
                <span class="promo-discount">Save {{ promo.minus }}%</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="divider"></div>

        <div class="promotion-section">
            <div class="promotion-title">ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ™ŸàÿµŸäŸÑ ŸÖÿ¨ÿßŸÜŸä ŸÖÿπ ŸÜÿ≥ÿÆÿ© ÿßŸÑÿ®ÿ±Ÿà!</div>
            <div class="promotion-subtitle">ÿ¨ÿ±ÿ® ŸÑŸÖÿØÿ© 14 ŸäŸàŸÖ</div>
            <button class="try-free-btn">ÿ¨ÿ±ÿ® ÿ®ÿßŸÑŸÖÿ¨ÿßŸÜ</button>
        </div>
    </div>

    <!-- Categories Tabs -->
    <div class="categories-tabs" id="categoriesTabs">
        <div class="category-tab featured active" data-category="all">ÿÆÿµŸäÿµÿß ŸÑŸÉ </div>
        {% for category in company.catagories %}
        <div class="category-tab" data-category="{{ category.id }}">{{ category.name }}</div>
        {% endfor %}
    </div>

    <!-- Products Grid -->
    <div class="products-grid" id="productsGrid">
        <!-- Products will be dynamically loaded here -->
    </div>

    

    <!-- Floating Cart - IMPROVED POSITIONING -->
    <div class="floating-cart">
        <div>
            <div class="cart-label">üõí ÿßŸÑÿ≥ŸÑÿ©</div>
            <div class="cart-total">0.000 ÿ±.ÿπ</div>
        </div>
        <a href="{{ url_for('main.user_cart') }}" class="footer-btn{% if request.endpoint == 'main.home' %} active{% endif %}" id="footerHomeBtn" title="Home">
            <button class="view-cart-btn" disabled>ÿßÿ∏Ÿáÿßÿ± ÿßŸÑÿ≥ŸÑÿ©</button>
        </a>
    </div>
</div>

<script>
let cart = [];
let cartTotal = 0;
let currentCategory = 'all';

// Sample featured products
const featuredProducts = [
    {
        name: "Premium Plant Bundle",
        description: "Best selling plants collection with care guide",
        price: 25.99,
        image: "https://images.unsplash.com/photo-1416879595882-3373a0480b5b?auto=format&fit=crop&w=300&q=80",
        category: "featured",
        badge: "üî• Popular"
    },
    {
        name: "Gardening Starter Kit",
        description: "Everything you need to start your green journey",
        price: 35.50,
        image: "https://images.unsplash.com/photo-1463320898484-cdee8141c787?auto=format&fit=crop&w=300&q=80",
        category: "featured",
        badge: "üÜï New"
    }
];

// ÿØÿßŸÑÿ© ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿØŸàŸÑÿßÿ± ÿ•ŸÑŸâ ÿ±ŸäÿßŸÑ ÿπŸÖÿßŸÜŸä (ÿ≥ÿπÿ± ÿ™ŸÇÿ±Ÿäÿ®Ÿä)
function convertToOMR(usdPrice) {
    return (usdPrice);
}

// ÿØÿßŸÑÿ© ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.style.background = type === 'success' ? '#4caf50' : '#f44336';
    notification.style.display = 'block';
    
    setTimeout(() => {
        notification.style.display = 'none';
    }, 3000);
}

// ÿØÿßŸÑÿ© ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ© ÿπÿ®ÿ± API
async function addToCartAPI(productName, price) {
    try {
        const response = await fetch('/cart/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                product_name: productName,
                price: price,
                quantity: 1,
                currency: 'OMR'
            })
        });

        if (response.ok) {
            const result = await response.json();
            return result;
        } else {
            throw new Error('Failed to add item to cart');
        }
    } catch (error) {
        console.error('Error adding to cart:', error);
        throw error;
    }
}

function goBack() {
    window.history.back();
}

function renderProducts(categoryId = 'all') {
    const productsGrid = document.getElementById('productsGrid');
    let productsToShow = [];

    if (categoryId === 'all') {
        // Show featured products + first 2 products from each category
        productsToShow = [...featuredProducts];
        {% for category in company.catagories %}
            productsToShow.push(...{{ category.products | tojson }}.slice(0, 2));
        {% endfor %}
    } else {
        // Show products from specific category
        {% for category in company.catagories %}
            if ('{{ category.id }}' === categoryId) {
                productsToShow = {{ category.products | tojson }};
            }
        {% endfor %}
    }

    if (productsToShow.length === 0) {
        productsGrid.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">üå±</div>
                <div style="font-weight: 600; margin-bottom: 8px;">No products found</div>
                <div style="font-size: 14px;">We're working to bring more products soon.</div>
            </div>
        `;
        return;
    }

    productsGrid.innerHTML = productsToShow.map(product => {
        const omrPrice = convertToOMR(product.price);
        return `
        <div class="product-card">
            <img src="${product.image}" alt="${product.name}" class="product-image">
            <div class="product-info">
                <div class="product-name">
                    ${product.name}
                    ${product.badge ? `<span class="badge">${product.badge}</span>` : ''}
                </div>
                <div class="product-description">${product.details || product.description || 'No description available'}</div>
                <div class="product-price-section">
                    <div class="product-price">${omrPrice} ÿ±.ÿπ</div>
                    <button class="add-button" onclick="addToCart('${product.name.replace(/'/g, "\\'")}', ${product.price}, this)">
                        ÿßÿ∂ÿßŸÅÿ©
                    </button>
                </div>
            </div>
        </div>
        `;
    }).join('');
}

async function addToCart(productName, usdPrice, button) {
    const omrPrice = convertToOMR(usdPrice);
    const item = {
        name: productName,
        price: omrPrice,
        usd_price: usdPrice,
        quantity: 1
    };
    
    // Show loading state
    button.textContent = 'ÿ™ÿ™ŸÖ ÿßŸÑÿßÿ∂ÿßŸÅÿ©';
    button.disabled = true;
    
    try {
        // Send request to backend
        await addToCartAPI(productName, parseFloat(omrPrice));
        
        // Update local cart
        cart.push(item);
        updateCartTotal();
        
        // Show success feedback
        button.textContent = 'ÿ™ŸÖÿ™ ÿßŸÑÿßÿ∂ÿßŸÅÿ©';
        button.classList.add('added', 'success');
        
        setTimeout(() => {
            button.textContent = 'ÿßÿ∂ÿßŸÅÿ©';
            button.classList.remove('added', 'success');
            button.disabled = false;
        }, 1000);
        
    } catch (error) {
        // Show error feedback
        button.textContent = 'ÿÆÿ∑ÿß!';
        button.style.background = '#f44336';
        
        setTimeout(() => {
            button.textContent = 'ÿßÿ∂ÿßŸÅÿ©';
            button.style.background = '';
            button.disabled = false;
        }, 1000);
    }
}

function updateCartTotal() {
    cartTotal = cart.reduce((total, item) => total + (parseFloat(item.price) * item.quantity), 0);
    document.querySelector('.cart-total').textContent = `${cartTotal.toFixed(3)} ÿ±.ÿπ`;
    
    const viewCartBtn = document.querySelector('.view-cart-btn');
    if (cartTotal > 0) {
        viewCartBtn.disabled = false;
    } else {
        viewCartBtn.disabled = true;
    }
}



// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    // Render initial products
    renderProducts();
    
    // Category tabs event listeners
    document.querySelectorAll('.category-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            const categoryId = this.getAttribute('data-category');
            currentCategory = categoryId;
            renderProducts(categoryId);
        });
    });
    
    // View cart button
    document.querySelector('.view-cart-btn').addEventListener('click', viewCart);
    
    // Try free button
    document.querySelector('.try-free-btn').addEventListener('click', function() {
        this.classList.add('loading');
        setTimeout(() => {
            this.classList.remove('loading');
            alert('üéâ Eco Pro trial started! Enjoy free delivery for 30 days.');
        }, 1000);
    });
});

// Add scroll effect for header
window.addEventListener('scroll', function() {
    const header = document.querySelector('.company-header');
    if (window.scrollY > 50) {
        header.style.boxShadow = '0 4px 20px rgba(3, 75, 6, 0.3)';
    } else {
        header.style.boxShadow = '0 2px 15px rgba(3, 75, 6, 0.2)';
    }
});
</script>
{% endblock %}