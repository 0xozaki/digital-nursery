{% extends 'base.html' %}
{% block head %}
<style>
  header { display: none !important; }
  .settings-header-circle {
    width: 54px;
    height: 54px;
    border-radius: 50%;
    background:white;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 24px auto 18px auto;
    box-shadow: 0 2px 8px rgba(56,142,60,0.10);
    position: relative;
  }
  .settings-back-btn {
    background: none;
    border: none;
    outline: none;
    color: #388e3c;
    font-size: 1.6rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    cursor: pointer;
    transition: background 0.18s;
  }
  .settings-back-btn:active {
    background: #c8e6c9;
  }
  
  /* Modal Styles */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }
  
  .modal-content {
    background: white;
    border-radius: 16px;
    padding: 24px;
    width: 90%;
    max-width: 320px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  }
  
  .modal-title {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 20px;
    text-align: center;
    color: #388e3c;
  }
  
  .language-option {
    display: flex;
    align-items: center;
    padding: 16px;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    margin-bottom: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .language-option:hover {
    border-color: #388e3c;
    background: #f8f9fa;
  }
  
  .language-option.selected {
    border-color: #388e3c;
    background: #e8f5e8;
  }
  
  .language-flag {
    font-size: 24px;
    margin-right: 12px;
  }
  
  .language-name {
    font-size: 1.1rem;
    font-weight: 600;
  }
  
  .soon-badge {
    background: #ff9800;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    margin-left: auto;
  }
</style>
{% endblock %}
{% block title %}Settings{% endblock %}
{% block content %}
<div class="container py-4">
  <div class="d-flex align-items-center mb-4" style="gap:14px;">
    <div class="settings-header-circle" style="width:44px;height:44px;margin:0;">
      <button class="settings-back-btn" id="settingsBackBtn" title="Back">
        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
      </button>
    </div>
    <div style="font-size:1.15rem;font-weight:700;color:#388e3c;" id="pageTitle">Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
  </div>
  <hr style="border:0;border-top:2.5px solid #bdbdbd;margin:0 0 22px 0;box-shadow:0 4px 16px 0 rgba(56,142,60,0.18);">

  <div class="list-group" style="max-width:420px;margin:auto;background:#ffffff">
    <a href="/account_info" class="list-group-item list-group-item-action d-flex align-items-center settings-menu-btn" style="gap:14px;font-size:1.08rem;background:#ffffff;border:none;">
      <svg width="22" height="22" fill="none" stroke="#388e3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M6 20v-2a4 4 0 0 1 4-4h0a4 4 0 0 1 4 4v2"/></svg>
      <span class="menu-text" data-key="myinfo">Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠ</span>
    </a>
    <a href="/account_info" class="list-group-item list-group-item-action d-flex align-items-center settings-menu-btn" style="gap:14px;font-size:1.08rem;background:#ffffff;border:none;">
      <svg width="22" height="22" fill="none" stroke="#388e3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="10" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
      <span class="menu-text" data-key="changepassword">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</span>
    </a>
    <a href="#" class="list-group-item list-group-item-action d-flex align-items-center settings-menu-btn" id="languageBtn" style="gap:14px;font-size:1.08rem;background:#ffffff;border:none;">
      <svg width="22" height="22" fill="none" stroke="#388e3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M3 6l3 1 3-1 3 1 3-1 3 1"/><path d="M4 6v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6"/></svg>
      <span class="menu-text" data-key="language">Ø§Ù„Ù„ØºØ©</span>
    </a>
    <a href="#" class="list-group-item list-group-item-action d-flex align-items-center settings-menu-btn" id="countryBtn" style="gap:14px;font-size:1.08rem;background:#ffffff;border:none;">
      <svg width="22" height="22" fill="none" stroke="#388e3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      <span class="menu-text" data-key="country">Ø§Ù„Ø¯ÙˆÙ„Ø©</span>
    </a>
    <a href="{{ url_for('main.logout') }}" class="list-group-item list-group-item-action d-flex align-items-center settings-menu-btn" style="gap:14px;font-size:1.08rem;background:#ffffff;border:none;color:#c62828;">
      <svg width="22" height="22" fill="none" stroke="#c62828" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
      <span class="menu-text" data-key="logout">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</span>
    </a>
    <style>
    .settings-menu-btn:hover, .settings-menu-btn:focus {
      background: #f1ede7 !important;
      color: #388e3c;
    }
    </style>
  </div>
</div>

<!-- Modal Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ© -->
<div class="modal-overlay" id="languageModal">
  <div class="modal-content">
    <div class="modal-title" id="languageModalTitle">Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©</div>
    
    <div class="language-option" data-lang="ar">
      <div class="language-flag">ðŸ‡¸ðŸ‡¦</div>
      <div class="language-name">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
    </div>
    
    <div class="language-option" data-lang="en">
      <div class="language-flag">ðŸ‡ºðŸ‡¸</div>
      <div class="language-name">English</div>
    </div>
  </div>
</div>

<!-- Modal Ù„Ù„Ø¯ÙˆÙ„Ø© -->
<div class="modal-overlay" id="countryModal">
  <div class="modal-content">
    <div class="modal-title" id="countryModalTitle">Ø§Ù„Ø¯ÙˆÙ„Ø©</div>
    <div style="text-align:center; padding:20px;">
      <div style="font-size:3rem; margin-bottom:16px;">ðŸš§</div>
      <div style="font-size:1.1rem; color:#666; margin-bottom:8px;" id="comingSoonText">Ù‚Ø±ÙŠØ¨Ø§Ù‹</div>
      <div style="font-size:0.9rem; color:#999;" id="comingSoonDesc">Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</div>
    </div>
  </div>
</div>


<div class="modal-overlay" id="langeModel">
  <div class="modal-content">
    <div class="modal-title" id="langeModelTitle">Ø§Ù„Ù„ØºØ©</div>
    <div style="text-align:center; padding:20px;">
      <div style="font-size:3rem; margin-bottom:16px;">ðŸš§</div>
      <div style="font-size:1.1rem; color:#666; margin-bottom:8px;" id="comingSoonText">Ù‚Ø±ÙŠØ¨Ø§Ù‹</div>
      <div style="font-size:0.9rem; color:#999;" id="comingSoonDesc">Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±</div>
    </div>
  </div>
</div>

<script>
// Ø¬Ù„Ø¨ Ø§Ù„Ù„ØºØ© ÙˆØªØ·Ø¨ÙŠÙ‚Ù‡Ø§
async function loadLanguage() {
    try {
        const response = await fetch('/get_language');
        const data = await response.json();
        const language = data.language || 'en';
        applyLanguage(language);
    } catch (error) {
        console.error('Error loading language:', error);
        applyLanguage('en');
    }
}

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
function applyLanguage(lang) {
    const texts = {
        en: {
            title: "Settings",
            myinfo: "My Info",
            changepassword: "Change Password",
            language: "Language", 
            country: "Country",
            logout: "Logout",
            chooseLanguage: "Choose Language",
            arabic: "Arabic",
            english: "English",
            comingSoon: "Coming Soon",
            underDevelopment: "This feature is under development"
        },
        ar: {
            title: "Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª",
            myinfo: "Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠ",
            changepassword: "ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", 
            language: "Ø§Ù„Ù„ØºØ©",
            country: "Ø§Ù„Ø¯ÙˆÙ„Ø©",
            logout: "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬",
            chooseLanguage: "Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©",
            arabic: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
            english: "English",
            comingSoon: "Ù‚Ø±ÙŠØ¨Ø§Ù‹",
            underDevelopment: "Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±"
        }
    };

    const t = texts[lang];
    
    if (!t) {
        console.error('No texts found for language:', lang);
        return;
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    document.getElementById('pageTitle').textContent = t.title;
    
    // ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    document.querySelectorAll('.menu-text').forEach(span => {
        const key = span.getAttribute('data-key');
        if (t[key]) {
            span.textContent = t[key];
        }
    });

    // ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø§Ù„Ù€ Modals
    document.getElementById('languageModalTitle').textContent = t.chooseLanguage;
    document.getElementById('langeModelTitle').textContent = t.language;
    document.getElementById('countryModalTitle').textContent = t.country;
    document.getElementById('comingSoonText').textContent = t.comingSoon;
    document.getElementById('comingSoonDesc').textContent = t.underDevelopment;

    // ØªØ­Ø¯ÙŠØ« Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø©
    document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
    document.body.style.textAlign = lang === 'ar' ? 'right' : 'left';
    
    // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹
    const backBtn = document.getElementById('settingsBackBtn');
    backBtn.title = lang === 'ar' ? 'Ø±Ø¬ÙˆØ¹' : 'Back';
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ØºØ© ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±
async function updateLanguage(lang) {
    try {
        const formData = new FormData();
        formData.append('language', lang);
        
        const response = await fetch('/update_language', {
            method: 'POST',
            body: formData
        });
        
        if (response.ok) {
            applyLanguage(lang);
            closeModal('languageModal');
        } else {
            console.error('Failed to update language');
        }
    } catch (error) {
        console.error('Error updating language:', error);
    }
}

// ÙØªØ­ Ø§Ù„Ù€ Modal
function openModal(modalId) {
    document.getElementById(modalId).style.display = 'flex';
}

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ Modal
function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„ØºØ© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    loadLanguage();
    
    // Back button click returns to account page
    document.getElementById('settingsBackBtn').onclick = function() {
        window.location.href = "{{ url_for('main.account') }}";
    };
    
    // ÙØªØ­ modal Ø§Ù„Ù„ØºØ©
    document.getElementById('languageBtn').onclick = function(e) {
        e.preventDefault();
        openModal('languageModal');
    };
    
    // ÙØªØ­ modal Ø§Ù„Ø¯ÙˆÙ„Ø©
    document.getElementById('countryBtn').onclick = function(e) {
        e.preventDefault();
        openModal('countryModal');
    };
    document.getElementById('langeBtn').onclick = function(e) {
        e.preventDefault();
        openModal('langeModel');
    };
    
    // Ø§Ø®ØªÙŠØ§Ø± Ù„ØºØ©
    document.querySelectorAll('.language-option').forEach(option => {
        option.onclick = function() {
            const lang = this.getAttribute('data-lang');
            updateLanguage(lang);
        };
    });
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ Modal Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
    document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.onclick = function(e) {
            if (e.target === this) {
                closeModal(this.id);
            }
        };
    });
    
    // Swipe left returns to account page
    let startX = null;
    document.addEventListener('touchstart', function(e) {
        if (e.touches.length === 1) startX = e.touches[0].clientX;
    });
    document.addEventListener('touchend', function(e) {
        if (startX !== null && e.changedTouches.length === 1) {
            let endX = e.changedTouches[0].clientX;
            if (startX - endX > 60) {
                window.location.href = "{{ url_for('main.account') }}";
            }
        }
        startX = null;
    });
});
</script>
{% endblock %}